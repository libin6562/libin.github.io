# MySQL面试题笔记

## 什么是sql

结构化查询语言，用于存取数据，查询，更新和管理数据库系统

## 数据库的三大范式

* 第一范式：每一列都不能再分割
* 第二范式：在第一范式的基础上，其他非主键列列全部依赖主键，而不是主键的一部分
* 第三范式：在第二范式的基础上，其他列只能依赖主键而不能依赖其他非主键

## MySQL数据类型

| 分类             | 类型名称     | 说明                       |
| ---------------- | ------------ | -------------------------- |
| 整数类型         | tinyInt      | 很小的整数(8位二进制)      |
|                  | mediumint    | 中等大小的整数(24位二进制) |
|                  | smallint     | 小的整数(16位二进制)       |
|                  | int(integer) | 普通大小的整数(32位二进制) |
| 小数类型         | float        | 单精度浮点数               |
|                  | double       | 双精度浮点数               |
|                  | decimal      | 压缩严格的定点数           |
| 日期类型         | year         | 年-年 例如：1949-1999      |
|                  | time         | 小时：分钟：秒             |
|                  | date         | 年月日                     |
|                  | datetime     | 年月日时分秒               |
|                  | datestamp    | 年月日时分秒+时区          |
| 文本，二进制类型 | char         | 0-255字节                  |
|                  | varchar      | 0-65535之间的整数          |
|                  | 。。。。     | 。。。。                   |

使用策略：

* 对于经常改变的数据来说，char比varchar更好，因为char不容易产生碎片
* 对于非常短的列 char比varchar存储效率更高
* 尽量使用datestamp空间效率要比datetime更高

## MySQL常用的存储引擎有什么？它们有什么区别？

* InnoDB
  * 是MySQL的默认引擎，支持事务，行锁，外键等操作
* MySAM
  * 是MySQL5.1以前的默认引擎，不支持事务，外键等操作，并发性差，默认的锁粒度为表级锁

* MySAM和InnoDB的区别
 ![image](https://user-images.githubusercontent.com/76958024/130192735-3f3eb122-1cfa-4ebc-89c6-96cfdf694912.png)


## 索引

什么是索引

>
>
>索引是对数据库表的一列或者多列的值进行[排序](https://www.nowcoder.com/jump/super-jump/word?word=排序)一种结构，使用索引可以快速访问数据表中的特定信息。

索引的优点和缺点

优点：

   * 大大加快数据检索的速度
   * 将随机I/O变成顺序I/O（因为B+树的叶子节点是连在一起的）
   * 加速表与表之间的连接

缺点：

* 从空间角度考虑，建立索引需要占用物理空间
* 从时间角度考虑，建立和维护索引都需要花费时间

索引的数据结构

* 索引的数据结构主要是B+树和哈希表，对应的索引分别是B+树索引和哈希索引，InnoDB引擎的索引类型有B+树索引和哈希索引，默认的索引类型为B+树索引
* B+树的索引又可以分为主索引和辅助索引。其中主索引为聚簇索引，辅助索引为非聚簇索引。聚簇索引是以主键作为B+ 树索引的键值所构成的B+树索引，聚簇索引的叶子节点存储着完整的数据记录；非聚簇索引是以非主键的列作为B+树索引的键值所构成的B+树索引，非聚簇索引的叶子节点存储着主键值。所以使用非聚簇索引进行查询时，会先找到主键值，然后到根据聚簇索引找到主键对应的数据域
* 哈希索引是基于[哈希表]()实现的，对于每一行数据，存储引擎会对索引列通过哈希[算法]()进行哈希计算得到哈希码，并且哈希[算法]()要尽量保证不同的列值计算出的哈希码值是不同的，将哈希码的值作为[哈希表]()的key值，将指向数据行的指针作为[哈希表]()的value值。这样查找一个数据的时间复杂度就是o(1)，一般多用于精确查找。

Hash索引和B+树的区别

* 哈希索引一般用于精确的等值查找，B+树索引则用于除了精确的等值查找外的其他查找，多数情况是使用B+树查找
* 哈希索引不支持排序，因为哈希表是无序的
* 哈希索引不支持模糊查询以及多列索引的最左前缀匹配
* 哈希索引不支持范围查询
* 因为哈希表存在哈希冲突所以哈希表是不稳定的，而B+索引是相对稳定的，因为每次查找都是从根节点到叶子节点

索引的类型有哪些

MySQL的主要索引类型有 FULLTEXT，HASH,BTREE,RTREE

* FULLTEXT
  * FULL即全文索引，MySAM和InnoDB在MySQL5.6.4以后支持全文索引，用于查找文本中的关键字，不是直接比较值是否相等，多在char,varchar,text上创建全文索引，主要是解决 where name = "%李%" 这种模糊查询效率低的问题。
* HASH
  * HASH即哈希索引，哈希索引多用于等值查询，效率非常高时间复杂度为O(1)，但是不支持排序，模糊查询，范围查询
* BTREE
  * BTREE即B+索引，InnoDB 存储引擎的默认索引，支持排序，分组，范围查询，模糊查询等，并且性能稳定
* RTREE
  * RTREE即空间数据索引，多用于存放地理信息，相比其他索引他的优势在于范围查找

索引的种类有哪些

* 主键索引：数据列不允许重复，不能为NULL，一个表只能有一个主键索引 

* 组合索引：由多个列值组成的索引。 

* 唯一索引：数据列不允许重复，可以为NULL，索引列的值必须唯一的，如果是组合索引，则列值的组合必须唯一。 

* 全文索引：对文本的内容进行搜索。 

* 普通索引：基本的索引类型，可以为NULL

B树和B+树的区别是什么

* B树的内部节点和叶子节点都存放键和值，B+树的内部节点只存放键不存放值，叶子节点存放键和值
* B+树的叶子节点是相互连在一起的，方便检索
![image](https://user-images.githubusercontent.com/76958024/130192771-996c64ad-bd11-47c2-a1d4-bd0163c10716.png)


数据库为什么使用B+树而不是B树

* B树用于随机查找而B+树用于随机查找和顺序查找
* B+树的空间效率更高，因为B树内部节点和叶子节点都要存放键和值，而B+树的内部节点只存放键，这样B+树的每一个节点就可以存放更多的索引，使树高变低，减少了I/O次数，是的数据检索速度更快
* B+树的叶子节点都是放在一起的，所以顺序检索和随机检索速度更快
* B+树更加稳定，因为在B+树中，每次查询都是根节点到叶子节点，而在B树中，要查询的值可能不在叶子节点直接在内部节点就查到了

什么是聚簇索引，什么是非聚簇索引？

聚簇索引和非聚簇索引的最主要区别是**数据和索引是否分开存储**

* 聚簇索引：将数据和索引放在一起存储 索引结构的叶子节点保留了数据行
* 非聚簇索引：将数据和索引分开存储，索引的叶子节点存储的是指向数据行的地址
* 
